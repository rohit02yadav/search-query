pipeline {
    agent any
    tools {
            maven 'maven-installer'
        }
    environment {
        REGISTRY = "yourdockerhubusername"
        IMAGE_NAME = "search-query"
        IMAGE_TAG = "${BUILD_NUMBER}"  // Use Jenkins build number as Docker tag
    }

    stages {
        stage('Checkout') {
            steps {
                // Checkout the code from the repository
                checkout scm
            }
        }

        stage('Build with Maven') {
            steps {
                script {
                       withMaven(maven: 'maven-installer', options: '-B -DskipTests') {  // Maven build with options
                                           sh 'mvn clean install'
                       }
                    // Build the project with Maven (skip tests if you want)
                }
            }
        }

//         stage('Build Docker Image') {
//             steps {
//                 script {
//                     // Build Docker image using Dockerfile
//                     docker.build("${REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}")
//                 }
//             }
//         }

//         stage('Push Docker Image') {
//             steps {
//                 script {
//                     // Login to Docker Hub
//                     withDockerRegistry([credentialsId: 'dockerhub-credentials', url: 'https://index.docker.io/v1/']) {
//                         // Push the Docker image to Docker Hub
//                         docker.image("${REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}").push()
//                     }
//                 }
//             }
//         }
    }

    post {
        success {
            echo "Build and push to Docker Hub successful!"
        }
        failure {
            echo "Build or Docker push failed!"
        }
    }
}
